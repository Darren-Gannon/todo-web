<ng-container *ngIf="{
    boards: boards$ | async,
    notifications: notifications$ | async,
    unreadNotifications: unreadNotifications$ | async
} as vm">
    <mat-drawer-container>
        <div>

            <mat-toolbar color="primary">
                <div id="navbar">
                    <div style="display: flex; align-items: center;">
                        <button mat-icon-button (click)="drawer.toggle()">
                            <mat-icon>menu</mat-icon>
                        </button>
                        <a routerLink="/" id="logo">
                            <img src="assets/redketchup/favicon-32x32.png" alt="logo">
                            <h1>Todo</h1>
                        </a>
                    </div>
                    <div>

                        <ng-container *ngIf="vm.notifications as notifications">
                            <ng-container *ngIf="notifications.loaded">
                                <button mat-icon-button [matMenuTriggerFor]="notificationMenu" [matBadge]="vm.unreadNotifications" [matBadgeHidden]="vm.unreadNotifications == 0" matBadgeColor="warn" style="font-size: .8rem;">
                                    <mat-icon>notifications</mat-icon>
                                </button>

                                <mat-menu #notificationMenu="matMenu">
                                    <div id="notifications-menu">
                                        <ng-container *ngFor="let notification of sortNotifications(Object.values(notifications.data))">
                                            <a class="notification-container" mat-menu-item [routerLink]="getNotificationLink(notification.data)">
                                                <div class="notification-link">
                                                    <mat-icon *ngIf="!notification.data.read" color="accent">adjust</mat-icon>
                                                    <span>{{ notification.data.title }}</span>
                                                </div>
                                            </a>
                                        </ng-container>
                                    </div>
                                    <mat-divider></mat-divider>
                                    <a style="text-decoration: none; color: unset;" mat-menu-item
                                        routerLink="/app/notification">
                                        <mat-icon color="primary">center_focus_weak</mat-icon>
                                        <span>Notification Center</span>
                                    </a>
                                </mat-menu>
                            </ng-container>
                        </ng-container>

                        <button mat-icon-button [matMenuTriggerFor]="settingsMenu">
                            <mat-icon>menu</mat-icon>
                        </button>

                        <mat-menu #settingsMenu="matMenu">
                            <a style="text-decoration: none; color: unset;" mat-menu-item routerLink="/app/account">
                                <mat-icon color="primary">account_circle</mat-icon>
                                <span>Account</span>
                            </a>
                            <hr>
                            <button mat-menu-item (click)="authService.logout()">
                                <mat-icon color="warn">logout</mat-icon>
                                <span>Sign Out</span>
                            </button>
                        </mat-menu>
                    </div>
                </div>
            </mat-toolbar>

            <div style="margin-bottom: 6px;">
                <router-outlet></router-outlet>
            </div>

        </div>

        <mat-drawer #drawer mode="over" id="drawer">
            <ng-container *ngIf="vm.boards as boards">
                <ng-container *ngIf="boards.loaded">
                    <mat-nav-list>
                        <ng-container *ngFor="let board of Object.values(boards.data)">
                            <ng-container *ngIf="board.loaded">
                                <a (click)="drawer.close()" mat-list-item [routerLink]="['/app/board', board.data.id]">{{
                                board.data.title }}</a>
                            </ng-container>
                        </ng-container>
                        <ng-container *ngIf="boards.loading; else createBoardTmpl">
                            <a class="stale" mat-list-item>
                                <span class="text"></span>
                            </a>
                        </ng-container>
                        <ng-template #createBoardTmpl>
                            <a (click)="drawer.close()" mat-list-item [routerLink]="['/app/board/new']">Create</a>
                        </ng-template>
                    </mat-nav-list>
                </ng-container>
            </ng-container>
        </mat-drawer>

    </mat-drawer-container>
</ng-container>